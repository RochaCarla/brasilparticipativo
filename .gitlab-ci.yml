stages:
  - test

image: lappis/decidim-govbr:v1-release
services:
  - postgres:13.2-alpine

before_script:
  # Project setup
  - bundle check || bundle install --jobs $(nproc)
  - npm install
  - yarn install

stages:
  - test

Testing:
  stage: test
  variables:
    POSTGRES_HOST: postgres
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: password
    RAILS_ENV: test
   script:
    - apt-get update -yy && apt-get install build-essential libpq-dev -y
    - bundle install
    - bundle exec rails db:setup
    - bundle exec rspec
