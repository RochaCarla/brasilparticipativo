<%= content_tag :div, id: node_id, data: { decidim_comments: comments_data } do %>
  <div class="columns comments-container" id="comments">
    <div class="comments">
      <%= add_comment %>
      <%= user_comments_blocked_warning %>
      <div class="comments-thread-title">
        <h3 class="section-heading comments-section-title">
          <%= t("decidim.components.comments_section_title.title", count: comments_count )%>
        </h3>
      </div>
      <div class="row collapse order-by">
        <div class="bp-row-collapse-space">
          <h3 class="order-by__text section-heading">
            <% if single_comment? %>
              <%= t("decidim.components.comments.comment_details_title") %>
            <% else %>
              <span class="comments-count">
                <%= t("decidim.components.comments.title", count: comments_count) %>
              </span>
            <% end %>
          </h3>
          <%= render :order_control %>
        </div>
      </div>
      <%= single_comment_warning %>
      <%= blocked_comments_warning %>
      <div class="comment-threads">
        <%= comments_loading %>
        <% comments.each do |comment| %>
          <%= cell("decidim/comments/comment_thread", comment, order: order) %>
        <% end %>
      </div>
        <%= link_to t("decidim.components.comments.load_more"),
            decidim_comments.comments_path(
                             commentable_gid: model.to_signed_global_id.to_s,
                             order: order),
            id: "load-more-comments", data: {
                                      page: order == "recent" ? 1 : total_pages,
                                      commentable_gid: model.to_signed_global_id.to_s,
                                      order: order,
                                      comments_count: comments_count,
                                      total_pages: total_pages},
            class: "br-button", remote: true %>
    </div>
    <div class="callout primary loading-comments hide">
      <p><%= t("decidim.components.comments.loading") %></p>
    </div>
  </div>
<% end %>
